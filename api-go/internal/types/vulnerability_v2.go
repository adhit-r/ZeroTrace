package types

import (
	"time"
)

// VulnerabilityV2Request represents the request structure for vulnerability v2 endpoints
type VulnerabilityV2Request struct {
	Category   string   `json:"category" form:"category"`     // application, network, configuration, system, auth, database, api, container, ai, iot, privacy, web3
	Severity   string   `json:"severity" form:"severity"`     // critical, high, medium, low, info
	Compliance string   `json:"compliance" form:"compliance"` // CIS, PCI-DSS, HIPAA, GDPR, SOC2, ISO27001
	SortBy     string   `json:"sort_by" form:"sort_by"`       // severity, discovered_date, risk_score
	SortOrder  string   `json:"sort_order" form:"sort_order"` // asc, desc
	Page       int      `json:"page" form:"page"`
	PageSize   int      `json:"page_size" form:"page_size"`
	AgentID    string   `json:"agent_id" form:"agent_id"`
	Search     string   `json:"search" form:"search"`
	Status     string   `json:"status" form:"status"` // open, resolved, mitigated
	DateFrom   string   `json:"date_from" form:"date_from"`
	DateTo     string   `json:"date_to" form:"date_to"`
	Export     string   `json:"export" form:"export"` // json, csv, pdf, sarif
	Tags       []string `json:"tags" form:"tags"`
}

// VulnerabilityV2Response represents the response structure for vulnerability v2 endpoints
type VulnerabilityV2Response struct {
	Vulnerabilities []VulnerabilityV2Data  `json:"vulnerabilities"`
	Total           int                    `json:"total"`
	Page            int                    `json:"page"`
	PageSize        int                    `json:"page_size"`
	TotalPages      int                    `json:"total_pages"`
	Categories      map[string]int         `json:"categories"`
	Severities      map[string]int         `json:"severities"`
	Compliance      map[string]int         `json:"compliance"`
	RiskScores      map[string]int         `json:"risk_scores"`
	Metadata        map[string]interface{} `json:"metadata"`
}

// VulnerabilityV2Data represents vulnerability data in responses
type VulnerabilityV2Data struct {
	ID                   string                 `json:"id"`
	AgentID              string                 `json:"agent_id"`
	Title                string                 `json:"title"`
	Description          string                 `json:"description"`
	Severity             string                 `json:"severity"`
	Category             string                 `json:"category"`
	Status               string                 `json:"status"`
	DiscoveredAt         time.Time              `json:"discovered_at"`
	LastSeen             time.Time              `json:"last_seen"`
	RiskScore            float64                `json:"risk_score"`
	ExploitComplexity    string                 `json:"exploit_complexity"`
	AttackVector         string                 `json:"attack_vector"`
	ComplianceFrameworks []string               `json:"compliance_frameworks"`
	Remediation          string                 `json:"remediation"`
	References           []string               `json:"references"`
	Tags                 []string               `json:"tags"`
	Metadata             map[string]interface{} `json:"metadata"`
	EnrichmentData       map[string]interface{} `json:"enrichment_data"`
	CreatedAt            time.Time              `json:"created_at"`
	UpdatedAt            time.Time              `json:"updated_at"`
}

// VulnerabilityStatsResponse represents vulnerability statistics
type VulnerabilityStatsResponse struct {
	Total              int                `json:"total"`
	ByCategory         map[string]int     `json:"by_category"`
	BySeverity         map[string]int     `json:"by_severity"`
	ByCompliance       map[string]int     `json:"by_compliance"`
	ByRiskScore        map[string]int     `json:"by_risk_score"`
	Trends             []TrendData        `json:"trends"`
	TopVulnerabilities []TopVulnerability `json:"top_vulnerabilities"`
	ComplianceScore    float64            `json:"compliance_score"`
	RiskScore          float64            `json:"risk_score"`
	LastUpdated        time.Time          `json:"last_updated"`
}

// TrendData represents trend data
type TrendData struct {
	Date     string `json:"date"`
	Count    int    `json:"count"`
	Severity string `json:"severity,omitempty"`
	Category string `json:"category,omitempty"`
}

// TopVulnerability represents top vulnerability
type TopVulnerability struct {
	ID          string  `json:"id"`
	Title       string  `json:"title"`
	Severity    string  `json:"severity"`
	Category    string  `json:"category"`
	Count       int     `json:"count"`
	RiskScore   float64 `json:"risk_score"`
	Description string  `json:"description"`
}

// ComplianceStatusResponse represents compliance status
type ComplianceStatusResponse struct {
	OverallScore    float64                   `json:"overall_score"`
	Frameworks      map[string]FrameworkScore `json:"frameworks"`
	GapAnalysis     []GapAnalysis             `json:"gap_analysis"`
	Recommendations []string                  `json:"recommendations"`
	LastAudit       time.Time                 `json:"last_audit"`
	NextAudit       time.Time                 `json:"next_audit"`
}

// FrameworkScore represents framework score
type FrameworkScore struct {
	Score        float64 `json:"score"`
	TotalChecks  int     `json:"total_checks"`
	PassedChecks int     `json:"passed_checks"`
	FailedChecks int     `json:"failed_checks"`
	Status       string  `json:"status"` // compliant, non_compliant, partial
}

// GapAnalysis represents gap analysis
type GapAnalysis struct {
	Framework   string `json:"framework"`
	Requirement string `json:"requirement"`
	Status      string `json:"status"`
	Gap         string `json:"gap"`
	Remediation string `json:"remediation"`
	Priority    string `json:"priority"`
}
